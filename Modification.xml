<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
/**
* @package manifest file for Like Posts
* @version 1.6.1
* @author Joker (http://www.simplemachines.org/community/index.php?action=profile;u=226111)
* @copyright Copyright (c) 2012, Siddhartha Gupta
* @license http://www.mozilla.org/MPL/MPL-1.1.html
*/

/*
* Version: MPL 1.1
*
* The contents of this file are subject to the Mozilla Public License Version
* 1.1 (the "License"); you may not use this file except in compliance with
* the License. You may obtain a copy of the License at
* http://www.mozilla.org/MPL/
*
* Software distributed under the License is distributed on an "AS IS" basis,
* WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
* for the specific language governing rights and limitations under the
* License.
*
* The Initial Developer of the Original Code is
*  Joker (http://www.simplemachines.org/community/index.php?action=profile;u=226111)
* Portions created by the Initial Developer are Copyright (C) 2012
* the Initial Developer. All Rights Reserved.
*
* Contributor(s):
*
*/
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>sid2varun:like_posts</id>
	<version>1.6.1</version>

	<file name="$themedir/Display.template.php">
		<operation>
			<search position="after"><![CDATA[// Is karma display enabled?  Total or +/-?]]></search>
			<add><![CDATA[if(!empty($modSettings['like_post_enable']) && LP_isBoardIncluded($context['current_board']) && LP_isAllowedTo(array('can_view_likes', 'can_view_likes_in_posts'))) {
				$total_likes = isset($context['like_posts']['posters_data'][$message['member']['id']]) ? $context['like_posts']['posters_data'][$message['member']['id']] : 0;

				echo '
								<li class="postcount"><a href="', $scripturl ,'?action=profile;area=likeposts;sa=seeotherslikes;u=', $message['member']['id'], '">', $txt['lp_total_likes'] . ': ' . $total_likes, '</a></li>';
			}

			]]></add>
		</operation>

		<operation>
			<search position="after"><![CDATA[// Show the member's signature?]]></search>
			<add><![CDATA[if(!empty($modSettings['like_post_enable']) && LP_isBoardIncluded($context['current_board']) && LP_isAllowedTo(array('can_like_posts', 'can_view_likes', 'can_view_likes_in_posts'))) {

			$context['like_posts']['single_msg_data'] = LP_isPostLiked($context['like_posts']['msgs_liked_data'], $message['id']);

			echo '<div class="like_post_box floatleft">';
			if(!$message['is_message_author'] && LP_isAllowedTo('can_like_posts')) {
				echo '
							<a class="', $context['like_posts']['single_msg_data']['already_liked'] ? 'like_link' : 'unlike_link', '" id="like_',$message['id'],'" href="#', $context['like_posts']['single_msg_data']['already_liked'], '" onclick="lpObj.likeUnlikePosts(event,', $message['id'],', ',$context['current_topic'],', ',$context['current_board'],', ',$message['member']['id'],'); return false;">', $context['like_posts']['single_msg_data']['text'],'</a>';
			}

			if(LP_isAllowedTo(array('can_view_likes', 'can_view_likes_in_posts'))) {
				echo '
							<a id="like_post_info_'. $message['id'] .'" href="javascript:void(0)" onclick="lpObj.showMessageLikedInfo(', $message['id'], ')">
								', !empty($context['like_posts']['single_msg_data']['count']) ? '<span id="like_count_'. $message['id'] .'">('. $context['like_posts']['single_msg_data']['count_text'] .')</span>' : '', '
							</a>';
			}
			echo '</div>';
		}

		]]></add>
		</operation>
	</file>

	<file name="$themedir/MessageIndex.template.php">
		<operation>
			<search position="before"><![CDATA[							<a href="', $topic['new_href'], '" id="newicon' . $topic['first_post']['id'] . '"><img src="', $settings['lang_images_url'], '/new.gif" alt="', $txt['new'], '" /></a>';]]></search>
			<add><![CDATA[

			if(!empty($modSettings['like_post_enable']) && !empty($modSettings['lp_show_like_on_boards']) && LP_isBoardIncluded($context['current_board']) && LP_isAllowedTo(array('can_like_posts', 'can_view_likes', 'can_view_likes_in_boards'))) {
				$context['like_posts']['single_topic_data'] = LP_isTopicLiked($context['like_posts']['topics_liked_data'], $topic['id']);
				echo '
					<div class="like_post_box floatright">';

				if($context['user']['id'] !== $topic['first_post']['member']['id'] && LP_isAllowedTo('can_like_posts')) {
					echo '
								<a class="', $context['like_posts']['single_topic_data']['already_liked'] ? 'like_link' : 'unlike_link', '" id="like_',$topic['first_post']['id'],'" href="#', $context['like_posts']['single_topic_data']['already_liked'], '" onclick="lpObj.likeUnlikePosts(event, ', $topic['first_post']['id'],', ',$topic['id'],', ',$context['current_board'],', ',$topic['first_post']['member']['id'],'); return false;">', $context['like_posts']['single_topic_data']['text'],'</a>';
				}
		
				if(LP_isAllowedTo(array('can_view_likes', 'can_view_likes_in_boards'))) {
					echo '
								<a id="like_post_info_'. $topic['first_post']['id'] .'" href="javascript:void(0)" onclick="lpObj.showMessageLikedInfo(', $topic['first_post']['id'], ')">', !empty($context['like_posts']['single_topic_data']['count']) ? '<span id="like_count_'. $topic['first_post']['id'] .'">('. $context['like_posts']['single_topic_data']['count_text'] .')</span>' : '', '</a>';
				}

				echo '
					</div>';
			}]]></add>
		</operation>
	</file>

    <file name="$themedir/index.template.php">
		<operation>
			<search position="replace"><![CDATA[<li><a href="', $scripturl, '?action=unreadreplies">', $txt['show_unread_replies'], '</a></li>';]]></search>
			<add><![CDATA[<li><a href="', $scripturl, '?action=unreadreplies">', $txt['show_unread_replies'], '</a></li>
					<li><a href="#" class="showLikeNotification" onclick="lpObj.showLikeNotification()">', $txt['like_show_notifications'], '</a></li>';]]></add>
		</operation>
	</file>
    
	<file name="$sourcedir/Display.php">
		<operation>
			<search position="after"><![CDATA[// Guests can't mark topics read or for notifications, just can't sorry.]]></search>
			<add><![CDATA[if(!empty($modSettings['like_post_enable'])) {
		require_once($sourcedir . '/LikePosts.php');
		if(LP_isBoardIncluded($context['current_board']) && LP_isAllowedTo(array('can_view_likes', 'can_view_likes_in_posts'))) {
			$lp_posters_data = LP_posterInfo($posters);
			$context['like_posts']['posters_data'] = isset($lp_posters_data) ? $lp_posters_data : array();
		}

		if(LP_isAllowedTo(array('can_like_posts', 'can_view_likes', 'can_view_likes_in_posts'))) {
			$topic_liked_data = LP_getAllMessagesInfo($messages);
			$context['like_posts']['msgs_liked_data'] = isset($topic_liked_data) ? $topic_liked_data : array();
		}
	}

	]]></add>
		</operation>
	</file>

	<file name="$sourcedir/MessageIndex.php">
		<operation>
			<search position="after"><![CDATA[
	$context['jump_to'] = array(]]></search>
			<add><![CDATA[
	if(!empty($modSettings['like_post_enable']) && !empty($modSettings['lp_show_like_on_boards'])) {
		require_once($sourcedir . '/LikePosts.php');
		if(LP_isBoardIncluded($context['current_board']) && LP_isAllowedTo(array('can_like_posts', 'can_view_likes', 'can_view_likes_in_boards'))) {
			$topic_liked_data = LP_getAllTopicsInfo($topic_ids, $board);
			$context['like_posts']['topics_liked_data'] = isset($topic_liked_data) ? $topic_liked_data : array();
		}
	}
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Load.php">
		<operation>
			<search position="after"><![CDATA[$context['menu_separator'] = !empty($settings['use_image_buttons']) ? ' ' : ' | ';]]></search>
			<add><![CDATA[$context['html_headers'] .= '<link rel="stylesheet" type="text/css" href="'. $settings['default_theme_url']. '/css/LikePosts.css" />';

	]]></add>
		</operation>
	</file>
</modification>
